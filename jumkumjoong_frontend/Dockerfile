# âš¡ 1. React ë¹Œë“œ ë‹¨ê³„
FROM node:24-alpine AS builder

# Node.jsì™€ npmì„ ì„¤ì¹˜ (í•„ìš”í•œ ê²½ìš°)
RUN apk add --no-cache nodejs npm
WORKDIR /app

# package.jsonê³¼ package-lock.jsonë§Œ ë³µì‚¬ í›„ ì˜ì¡´ì„± ì„¤ì¹˜ (ìµœì í™”)
COPY package.json package-lock.json ./
RUN npm install # --production ì˜µì…˜ì„ ì œê±°í•˜ì—¬ ê°œë°œ ì˜ì¡´ì„±ë„ í•¨ê»˜ ì„¤ì¹˜

# ì†ŒìŠ¤ ì½”ë“œ ë³µì‚¬ í›„ ë¹Œë“œ ì‹¤í–‰
COPY . .
RUN npm run build

# ğŸƒâ€â™‚ï¸ 2. EC2ì—ì„œ ì‚¬ìš©í•  ë°°í¬ìš© ì»¨í…Œì´ë„ˆ
FROM alpine:latest

WORKDIR /app

# ë¹Œë“œ ê²°ê³¼ë¬¼ì„ /var/www/html/ë¡œ ë³µì‚¬í•˜ê¸° ìœ„í•´ tar ì‚¬ìš©
COPY --from=builder /app/build /app/build
RUN tar -czf build.tar.gz -C /app/build .

# EC2ë¡œ ì „ì†¡í•  ì¤€ë¹„ ì™„ë£Œ ë©”ì‹œì§€
CMD ["sh", "-c", "echo 'React build files are ready. Copy build.tar.gz to EC2 and extract to /var/www/html/'"]
