# âš¡ 1. React ë¹Œë“œ ë‹¨ê³„
FROM node:24-alpine AS builder  

WORKDIR /app

# package.jsonë§Œ ë³µì‚¬ í›„ ì˜ì¡´ì„± ì„¤ì¹˜ (ìµœì í™”)
COPY package.json package-lock.json ./
RUN npm install
RUN npm ci --production

# ì†ŒìŠ¤ ì½”ë“œ ë³µì‚¬ í›„ ë¹Œë“œ ì‹¤í–‰
COPY . .
RUN npm run build

# ğŸƒâ€â™‚ï¸ 2. EC2ì—ì„œ ì‚¬ìš©í•  ë°°í¬ìš© ì»¨í…Œì´ë„ˆ
FROM alpine:latest

# ë¹Œë“œ ê²°ê³¼ë¬¼ì„ /var/www/html/ë¡œ ë³µì‚¬í•˜ê¸° ìœ„í•´ tar ì‚¬ìš©
WORKDIR /app
COPY --from=builder /app/build /app/build
RUN tar -czf build.tar.gz -C /app/build .

CMD ["sh", "-c", "echo 'React build files are ready. Copy build.tar.gz to EC2 and extract to /var/www/html/'"]